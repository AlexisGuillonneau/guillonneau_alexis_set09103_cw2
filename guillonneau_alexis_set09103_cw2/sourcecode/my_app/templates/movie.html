{% extends "base.html" %}
{%block head%}
    {{super()}}
    <link href="{{ url_for('static', filename='css/movie.css')}}" rel="stylesheet">
{%endblock%}


{% block nav%}
    <li class="nav-item">
        <a class="nav-link" href="{{url_for('movie.index')}}">Home</a>
    </li>
    <li class="nav-item">
        <a class="nav-link active" href="{{url_for('movie.display_all_movies')}}">Movies</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{{url_for('movie.about')}}">About</a>
    </li>
    {%if session['logged']%}
    <li class="nav-item">
        <a class="nav-link" href="{{url_for('movie.account')}}">Your account</a>
    </li>
    {%else%}
    <li class="nav-item">
        <a class="nav-link" href="{{url_for('movie.login')}}">Login</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{{url_for('movie.sign')}}">Sign</a>
    </li>
    {%endif%}
{%endblock%}



{%block main%}
<div class="video-background">
    <div class="video-foreground">
      <iframe src="http://www.youtube.com/embed/{{movie[12]}}??controls=0&showinfo=0&rel=0&autoplay=1&loop=1&playlist={{movie[12]}}" frameborder="0" allowfullscreen></iframe>
    </div>
  </div>
</div>



<!-- <div id="vidtop-content">
<div class="vid-info">
      <h1>YouTube Fullscreen Background Demo</h1>
      <p>The International Space Station orbits the Earth every 92 minutes, with its crew seeing a sunrise 15 times a day. It exists as a scientific, educational, and engineering platform in low orbit, 330 to 435 kilometres above the Earth.
     <p>Original timelapse by Riccardo Rossi (ISAA), used under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License. Raw photos courtesy of http://eol.jsc.nasa.gov/
     <a href="/500/Use-YouTube-Videos-as-Fullscreen-Web-Page-Backgrounds">Full article</a>
  </div>
</div> -->

    	<div class="container" id="vidtop-content*">	
    		
    		<div class="row vid-info">
    		
    		<!-- <div class="col-lg-4 col-md-6 col-sm-6 portfolio-item">
	          <div class="card h-100">
	            <a href="#"><img class="card-img-top" src="https://image.tmdb.org/t/p/original/{{movie[11]}}" alt="" style="max-width:auto;max-height: auto;"></a>
	            <div class="card-body">
	              <h5>Year:</h5><p class="card-text"><a href="{{url_for('movie.year',year=movie[6])}}">{{movie[6]|int}}</a></p>
	              <h5>Length:</h5><p class="card-text">{{movie[5]|int}} minutes</p>
	            </div>
	          </div>
	        </div>
 -->	        <div class="">
	        <div class="card-body">
                <div class="parent">
                    <div class="superpose icones">
                        <img class="card-img-top" src="https://image.tmdb.org/t/p/original/{{movie[11]}}" alt="" style="max-width:50%;max-height: auto;">
                        <div class="row star">
                                <img src="{{url_for('static',filename='images/star_empty_w.svg')}}" style="max-width: 10%;margin-left: 25%;" id="star1">
                                <img src="{{url_for('static',filename='images/star_empty_w.svg')}}" style="max-width: 10%;" id="star2">
                                <img src="{{url_for('static',filename='images/star_empty_w.svg')}}" style="max-width: 10%;" id="star3">
                                <img src="{{url_for('static',filename='images/star_empty_w.svg')}}" style="max-width: 10%;" id="star4">
                                <img src="{{url_for('static',filename='images/star_empty_w.svg')}}" style="max-width: 10%;margin-right: 25%;" id="star5">
                        </div>
                       <button class="btn"  style='background-color:transparent;' id="heart"> <img src="{{url_for('static',filename='images/heart_empty_w.svg')}}" style="max-width: 10%;"></button>
                       <button class="btn"  style='background-color:transparent;' id="add"><img src="{{url_for('static',filename='images/add_w.svg')}}" style="max-width: 10%;"></button> 
                    </div>

                    
                 </div>
                 </div>
                 <div class="contenu">
                    
    	              <blockquote class="blockquote text-center">
                          <h3>{{movie[1]}}<h5>Rating: {{rating}}/5</h5></h3>
                          
                            <h5>Year:</h5><p class="card-text"><a href="{{url_for('movie.year',year=movie[6])}}">{{movie[6]|int}}</a></p>
                            <h5>Length:</h5><p class="card-text">{{movie[5]|int}} minutes</p>
                          
    					  <p class="mb-0">{{movie[9]}}</p>

    					  <footer class="blockquote-footer"><cite title="Source Title">themoviedb.org</cite></footer>
    					</blockquote>
    	              <!-- <p class="card-text">{{movie[9]}}</p> -->
    	              <h5>Director:</h5><p class="director">
                        {%if movie[3] is not none%}
                       {%set directors = movie[3].split(';')%}
                        {%for director in directors%}
                            <a href="{{url_for('movie.director',director=director)}}">{{director}}</a>
                            {%if not loop.last%}
                            
                            {%endif%}
                        {%endfor%}   
                        {%endif%}
                      </p>
    	              <h5>Producer:</h5><p class="producer">
                        {%if movie[4] is not none%}
                       {%set producers = movie[4].split(';')%}
                        {%for producer in producers%}
                            <a href="{{url_for('movie.producer',producer=producer)}}">{{producer}}</a>
                            {%if not loop.last%}
                            
                            {%endif%}
                        {%endfor%} 
                        {%endif%}  
                      </p>
    	              <h5>Actor:</h5><p class="actor">
                        {%if movie[7] is not none%}
                        {%set actors = movie[7].split(';')%}
                        {%for a in actors%}
                            <a href="{{url_for('movie.actor',actor=a)}}">{{a}}</a>
                            {%if not loop.last%}
                            
                            {%endif%}
                        {%endfor%}
                        {%endif%}
                        </p>
    	              <h5>Country:</h5><p class="country">
                        {%if movie[8] is not none%}
                        {%set countries = movie[8].split(';')%}
                        {%for country in countries%}
                            <a href="{{url_for('movie.country',country=country)}}">{{country}}</a>
                            {%if not loop.last%}
                            
                            {%endif%}
                        {%endfor%}
                        {%endif%}
                      </p>
    	              <h5>Distribution:</h5><p class="distribution">
                    {%if movie[10] is not none%}
                       {%set distributions = movie[10].split(';')%}
                        {%for distribution in distributions%}
                            <a href="{{url_for('movie.distribution',distribution=distribution)}}">{{distribution}}</a>
                            {%if not loop.last%}
                            
                            {%endif%}
                        {%endfor%} 
                        {%endif%}
                      </p>
    	              <h5>
                        {%set cat_len = movie[2].split(';')%}
    	              	{%if cat_len|length > 1 %}
    	              		Categories:
    	              	{%else%}
    	              		Category:
    	              	{%endif%}

    	              </h5><p class="category">
    	              	{%for c in cat_len%}
    	              		<a href="{{url_for('movie.category',category=c)}}">{{c}}</a>
    	              		{%if not loop.last%}
    	              		
    	              		{%endif%}
    	              	{%endfor%}
    	              </p>


                      <div class='row comments'>
                        <h5>Comments:</h5>
                        <ul class="list-group">
                        </ul>
                      </div>
                  </div>

                  {%if session['logged']%}
                    
                        

                        
                            <div class="form-group">
                                <label for="comment">Add comment:</label>
                                <textarea class="form-control" rows="5" id="comment" name='body'></textarea>
                                <button class="btn btn-success" id="commentSubmit">Submit</button>
                            </div>
                        
                                            
                    
                  {%endif%}
	            </div>
	        </div>
	        
	</div>
</div>
<script type="text/javascript">
    
    $(document).ready(function(){

        var id = {{movie[0]}};

        

        function isReponse(tab){
            if(tab == -1){
                return '';
            }else{
                return '&#8618;'
            }
        }

        

       

        {%if session['logged']%}

        $.getJSON("{{url_for('movie.getState')}}",{
                            id_movie: id, // in flask, "q" will be the argument to look for using request.args
                        }, function(data) {
                            state = data['response'][0];
                            console.log(state);
                            if(state == 1){
                                $('#add').find('img').attr('src',"{{url_for('static',filename='images/checked_w.svg')}}");
                            }else if(state == 2){
                                $('#heart').find('img').attr('src',"{{url_for('static',filename='images/heart_w.svg')}}");
                            }
                        });

        var rating = 0;

         $.getJSON("{{url_for('movie.rating')}}",{
                            id_movie: id, // in flask, "q" will be the argument to look for using request.args
                        }, function(data) {
                            rating = data['response'][0];
                            for(i=1;i<=rating;i++){
                                $('#star'+i).attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                            }
                        });
        
            $('#star1').mouseover(function(){
                
                    $('#star1').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                    $('#star2').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
                    $('#star3').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
                    $('#star4').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
                    $('#star5').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
                
            }).mouseout(function(){
                console.log(rating);
                for(j=1;j<=rating;j++){
                    $('#star'+j).attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                }
                for(k=rating+1;k<=5;k++){
                     $('#star'+k).attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
                }
            }).on('click',function(){
                rating = 1;
                $.getJSON("{{url_for('movie.changeRating')}}",{
                            id_movie: id,
                            rating: rating // in flask, "q" will be the argument to look for using request.args
                        }, function(data) {
                            console.log(data['response']);
                            for(j=1;j<=rating;j++){
                                $('#star'+j).attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                            }
                        });
            });

            $('#star2').mouseover(function(){
                
                    $('#star1').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                    $('#star2').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                    $('#star3').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
                    $('#star4').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
                    $('#star5').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
                
            }).mouseout(function(){
                for(j=1;j<=rating;j++){
                    $('#star'+j).attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                }
                for(k=rating+1;k<=5;k++){
                     $('#star'+k).attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
                }
            }).on('click',function(){
                rating = 2;
                $.getJSON("{{url_for('movie.changeRating')}}",{
                            id_movie: id,
                            rating: rating // in flask, "q" will be the argument to look for using request.args
                        }, function(data) {
                            console.log(data['response']);
                            for(j=1;j<=rating;j++){
                                $('#star'+j).attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                            }
                        });
            });

            $('#star3').mouseover(function(){
                
                    $('#star1').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                    $('#star2').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                    $('#star3').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                    $('#star4').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
                    $('#star5').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
                
            }).mouseout(function(){
                for(j=1;j<=rating;j++){
                    $('#star'+j).attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                }
                for(k=rating+1;k<=5;k++){
                     $('#star'+k).attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
                }
            }).on('click',function(){
                rating = 3;
                $.getJSON("{{url_for('movie.changeRating')}}",{
                            id_movie: id,
                            rating: rating // in flask, "q" will be the argument to look for using request.args
                        }, function(data) {
                            console.log(data['response']);
                            for(j=1;j<=rating;j++){
                                $('#star'+j).attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                            }
                        });
            });

            $('#star4').mouseover(function(){
                
                    $('#star1').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                    $('#star2').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                    $('#star3').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                    $('#star4').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                    $('#star5').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
                
            }).mouseout(function(){
                for(j=1;j<=rating;j++){
                    $('#star'+j).attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                }
                for(k=rating+1;k<=5;k++){
                     $('#star'+k).attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
                }
            }).on('click',function(){
                rating = 4;
                $.getJSON("{{url_for('movie.changeRating')}}",{
                            id_movie: id,
                            rating: rating // in flask, "q" will be the argument to look for using request.args
                        }, function(data) {
                            console.log(data['response']);
                            for(j=1;j<=rating;j++){
                                $('#star'+j).attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                            }
                        });
            });

            $('#star5').mouseover(function(){
                
                    $('#star1').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                    $('#star2').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                    $('#star3').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                    $('#star4').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                    $('#star5').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                
            }).mouseout(function(){
                for(j=1;j<=rating;j++){
                    $('#star'+j).attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                }
                for(k=rating+1;k<=5;k++){
                     $('#star'+k).attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
                }
            }).on('click',function(){
                rating = 5;
                $.getJSON("{{url_for('movie.changeRating')}}",{
                            id_movie: id,
                            rating: rating // in flask, "q" will be the argument to look for using request.args
                        }, function(data) {
                            console.log(data['response']);
                            for(j=1;j<=rating;j++){
                                $('#star'+j).attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
                            }
                        });
            });

        
         
        function displayComments(){
            $('.comments').find('ul').empty();
            var all_comments = [];
            $.getJSON("{{url_for('movie.getCom')}}",{
                    id: id,
                },function(data){
                    all_comments = data['response'];
                    all_comments.forEach(function(el){
                        $('.comments').find('ul').append("<li data-com="+el[0]+" class='list-group-item' id='com'><p>"+isReponse(el[4])+el[1]+" : "+el[2]+"</p><button type='button' class='btn btn-light' id='plus'><img style='max-width:5%;margin-right:2%;'  src='{{url_for('static',filename='images/plus.svg')}}' data-toggle='tooltip' data-placement='top' title='Reply to this comment'>Reply to this comment</button></li>");
                        all_comments.forEach(function(element){
                            if(el[0] == element[4]){
                                $('.comments').find('ul').append("<li class='list-group-item' id='com'><p>"+isReponse(element[4])+element[1]+" : "+element[2]+"</p></li>");
                                var index = all_comments.indexOf(element);
                                all_comments.splice(index,1);
                            }
                            
                        });
                    });
                }
            );
        }

        displayComments();

        $('#commentSubmit').click(function(){
            var body = $('#comment').val();
            $.getJSON("{{url_for('movie.comment')}}",{
                            body: body,
                            id_movie: id,
                            parent: -1, // in flask, "q" will be the argument to look for using request.args
                        }, function(data) {
                            console.log(data['response']);
                            $('#comment').val('');
                             displayComments();
                        });

        });

        $('#heart').click(function(){

            $.getJSON("{{url_for('movie.like')}}",{
                            q: id, // in flask, "q" will be the argument to look for using request.args
                        }, function(data) {
                            if(data['response'][0] == 2){

                                $('#heart').find('img').attr('src',"{{url_for('static',filename='images/heart_w.svg')}}");
                            }else if(data['response'][0] == 0){

                                $('#heart').find('img').attr('src',"{{url_for('static',filename='images/heart_empty_w.svg')}}");
                            }
                            
                        });
        });

        $('#add').click(function(){

            $.getJSON("{{url_for('movie.list')}}",{
                            q: id, // in flask, "q" will be the argument to look for using request.args
                        }, function(data) {
                            console.log(data['response'][0]);
                            if(data['response'][0] == 1){

                                $('#add').find('img').attr('src',"{{url_for('static',filename='images/checked_w.svg')}}");
                            }else if(data['response'][0] == 0){

                                $('#add').find('img').attr('src',"{{url_for('static',filename='images/add_w.svg')}}");
                            }
                            
                        });
        });

        $('ul').on('click','button',function(event){
            if($(event.target).find('div').length == 0){
                $(event.target).parent().append("<div class='form-group'><label for='commentRep'>Response:</label><textarea class='form-control' rows='5' id='commentRep' name='bodyRep'></textarea><button class='btn btn-success' id='commentSubmitRep'>Submit</button></div>");
            }
            if($(event.target).attr('id') == "commentSubmitRep"){
                var body = $(event.target).prev().val()
                var parent = $(event.target).parent().parent().attr('data-com');
                 $.getJSON("{{url_for('movie.comment')}}",{
                            body: body,
                            id_movie: id,
                            parent : parent, // in flask, "q" will be the argument to look for using request.args
                        }, function(data) {
                            console.log(data['response']);
                             displayComments();
                        });
            }   
        });
        {%else%}

        $('#star1').mouseover(function(){
            $(this).attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
        }).mouseout(function(){
             $(this).attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
        });
        $('#star2').mouseover(function(){
            $('#star1').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
            $(this).attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
        }).mouseout(function(){
            $('#star1').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
            $(this).attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
        });
        $('#star3').mouseover(function(){
            $('#star1').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
            $('#star2').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
            $(this).attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
        }).mouseout(function(){
            $('#star1').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
            $('#star2').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
            $(this).attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
        });
        $('#star4').mouseover(function(){
            $('#star1').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
            $('#star2').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
            $('#star3').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
            $(this).attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
        }).mouseout(function(){
            $('#star1').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
            $('#star2').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
            $('#star3').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
            $(this).attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
        });
        $('#star5').mouseover(function(){
            $('#star1').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
            $('#star2').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
            $('#star3').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
            $('#star4').attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
            $(this).attr('src',"{{url_for('static',filename='images/star_w.svg')}}");
        }).mouseout(function(){
            $('#star1').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
            $('#star2').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
            $('#star3').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
            $('#star4').attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
            $(this).attr('src',"{{url_for('static',filename='images/star_empty_w.svg')}}");
        });

        displayComments();


        function displayComments(){
            $('.comments').find('ul').empty();
            var all_comments = [];
            $.getJSON("{{url_for('movie.getCom')}}",{
                    id: id,
                },function(data){
                    all_comments = data['response'];
                    all_comments.forEach(function(el){
                        $('.comments').find('ul').append("<li class='list-group-item' id='com'><p>"+isReponse(el[4])+el[1]+" : "+el[2]+"</p></li>");
                        all_comments.forEach(function(element){
                            if(el[0] == element[4]){
                                $('.comments').find('ul').append("<li class='list-group-item' id='com'><p>"+isReponse(element[4])+element[1]+" : "+element[2]+"</p></li>");
                                var index = all_comments.indexOf(element);
                                all_comments.splice(index,1);
                            }
                            
                        });
                    });
                }
            );
        }

        {%endif%}
    });
        

    
</script>
{%endblock%}

